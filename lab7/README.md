# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ7

pg01 and pg02, –Ω–∞ –∫–∞–∂–¥–æ–º –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç:

* PostgreSQL
* Patroni
* Consul agent

1. –£—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –∫–æ–Ω—Å—É–ª.

````
ansible-playbook consul.play
````

2. –ü—Ä–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –ë–î –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö –¥–∏—Å–∫–∞—Ö. –ë–î –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ /pgsql/pg_data/14. WAL –∞—Ä—Ö–∏–≤—ã –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ /pgsql/pg_wal/14. –í —ç—Ç–∏ –ø–∞–ø–∫–∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–∏—Å–∫–∏ /dev/sdb –∏ /dev/sdc —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. –î–∏—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ LVM –∏ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ xfs.

````
vgcreate pgdata /dev/sdb
vgcreate pgwal /dev/sdc
````

````
lvcreate -l+100%FREE -n pgdata pgdata
lvcreate -l+100%FREE -n pgwal pgwal
````

````
mkfs.xfs /dev/mapper/pgdata-pgdata
mkfs.xfs /dev/mapper/pgwal-pgwal
````

3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö pg1 –∏ pg2 –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ Patroni.

````
yum install patroni-2.0.2-1.rhel7.x86_64.rpm
````


4. –° –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã vip-manager –æ–±–µ—Å–ø–µ—á–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É VIP –∞–¥—Ä–µ—Å–∞ –Ω–∞ –º–∞—Å—Ç–µ—Ä —Å–µ—Ä–≤–µ—Ä–µ. 

````
yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
````

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ —à–∏–∏–∏–∫–∞—Ä–Ω–Ω–æ–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ!)

* C–Ω–æ—Å–∏–º –≤—Å–µ –Ω–∞—Ñ–∏–≥, –∞ –¥–ª—è —á–µ–≥–æ –∂–µ –º—ã –µ—â–µ —ç—Ç–æ —Ç–∞–∫ –¥–æ–ª–≥–æ –¥–µ–ª–∞–ª–∏üôÉüôÉüôÉüôÉüôÉüôÉüôÉüôÉ

````
vagrant destroy --force
````

* –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª–∫—É

````
vagrant up
```` 
* –ö–∞–∫–æ–π-—Ç–æ consul, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –∏–∑ –ø–æ—Å–æ–ª—å—Å—Ç–≤–∞)))
````
ansible-playbook consul.yml
````

* –ó–∞–ø—É—Å–∫–∞–µ–º —á—É–¥–µ—Å–Ω—ã–π-—Ä–∞—Å—á—É–¥–µ—Å–Ω—ã–π playbook (–ø–ª—ç–π - –∏–≥—Ä–∞—Ç—å, –±—É–∫ - –∫–Ω–∏–≥–∞)

````
ansible-playbook playbook.yml
````

# –í–∞—É—É—Éüôå‚ú® –∑–≤—É–∫–∏ –≤–æ—Å—Ç–æ—Ä–≥–∞ –∏ –∑–µ–ª–µ–Ω–æ–π —è—á–µ–π–∫–∏ –≤ —Ç–∞–±–ª–∏—á–∫–µüíöüíöüíö

<a href="https://ibb.co/yRN18zj"><img src="https://i.ibb.co/591y5QH/blya1.png" alt="blya1" border="0"></a>

<a href="https://ibb.co/KWvw7kH"><img src="https://i.ibb.co/tDrXct5/blya2.png" alt="blya2" border="0"></a>


